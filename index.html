<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MSHYA Coin Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    .shop-row {
      display: flex;
      justify-content: space-between;
      background: #222;
      margin: 10px 0;
      padding: 15px;
      border-radius: 10px;
    }
    .shop-amount {
      font-weight: bold;
    }
    .shop-buy {
      background: #00aaff;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üí∞ MSHYA Coin Shop</h2>

  <div class="shop-row">
    <div class="shop-amount">50,000,000 MSHYA</div>
    <button class="shop-buy" data-ton="1">Buy for 1 TON</button>
  </div>
  <div class="shop-row">
    <div class="shop-amount">100,000,000 MSHYA</div>
    <button class="shop-buy" data-ton="2">Buy for 2 TON</button>
  </div>
  <div class="shop-row">
    <div class="shop-amount">500,000,000 MSHYA</div>
    <button class="shop-buy" data-ton="10">Buy for 10 TON</button>
  </div>

 <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  // Supabase client create ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç - ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø conflict ‡§® ‡§π‡•ã
  const supabaseClient = supabase.createClient(
    'https://vaxelepziqqpteyqokrc.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZheGVsZXB6aXFxcHRleXFva3JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMTQ3NDcsImV4cCI6MjA2OTU5MDc0N30.tRTdbffdk2Xcq-2YxlZZM2TkYahuhJnrRjesKy-dptQ'
  );

  // Function to get Telegram User ID
  function getTelegramUserId() {
    if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
      return Telegram.WebApp.initDataUnsafe.user.id.toString();
    }
    return null;
  }

  // üí∞ Buy buttons ‡§™‡§∞ listener
  document.querySelectorAll('.shop-buy').forEach((button) => {
    button.addEventListener('click', async () => {
      const row = button.closest('.shop-row');
      const amountText = row.querySelector('.shop-amount').innerText;
      const mshyaAmount = parseInt(amountText.replace(/[^0-9]/g, ''));

      const confirmed = confirm(`‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ${mshyaAmount.toLocaleString()} MSHYA ‡§ñ‡§∞‡•Ä‡§¶‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?`);
      if (!confirmed) return;

      const buyUserId = getTelegramUserId();

      if (!buyUserId) {
        alert('‚ùå Telegram ‡§∏‡•á User ID ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ Telegram Bot ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ó‡•á‡§Æ ‡§ñ‡•ã‡§≤‡•á‡§Ç‡•§');
        return;
      }

      // üîç Supabase ‡§∏‡•á user data ‡§®‡§ø‡§ï‡§æ‡§≤‡§®‡§æ
      const { data: user, error } = await supabaseClient
        .from('users')
        .select('mshya')
        .eq('id', buyUserId)
        .single();

      if (error || !user) {
        alert('‚ùå User ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ Supabase ‡§Æ‡•á‡§Ç‡•§ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à ‡§Ü‡§™‡§®‡•á signup/register ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•ã‡•§');
        return;
      }

      const newBalance = (user.mshya || 0) + mshyaAmount;

      // ‚úÖ Supabase ‡§Æ‡•á‡§Ç balance update ‡§ï‡§∞‡§®‡§æ
      const { error: updateError } = await supabaseClient
        .from('users')
        .update({ mshya: newBalance })
        .eq('id', buyUserId);

      if (updateError) {
        alert('‚ùå Balance update ‡§Æ‡•á‡§Ç error ‡§Ü‡§Ø‡§æ!');
      } else {
        alert(`‚úÖ ${mshyaAmount.toLocaleString()} MSHYA coins ‡§Ü‡§™‡§ï‡•á ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§è ‡§ó‡§è!`);
      }
    });
  });
</script>
</body>
</html>